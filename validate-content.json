#!/bin/bash

echo "ğŸ” Validating content.json file..."

# Check if content.json exists
if [ ! -f "content.json" ]; then
    echo "âŒ content.json file not found!"
    exit 1
fi

# Validate JSON syntax
if python3 -m json.tool content.json > /dev/null 2>&1; then
    echo "âœ… JSON syntax is valid"
else
    echo "âŒ JSON syntax is invalid"
    exit 1
fi

# Check required fields using Python
echo "ğŸ” Checking required fields..."
python3 -c "
import json

with open('content.json', 'r') as f:
    data = json.load(f)

required_fields = ['name', 'short_name', 'description', 'version', 'icons', 'start_url', 'display', 'theme_color', 'background_color']

for field in required_fields:
    if field in data:
        print(f'âœ… {field} field found')
    else:
        print(f'âŒ {field} field missing')
"

# Check icon files exist
echo "ğŸ” Checking icon files..."
python3 -c "
import json
import os

with open('content.json', 'r') as f:
    data = json.load(f)

icons = data.get('icons', [])
missing_icons = []

for icon in icons:
    src = icon.get('src', '')
    if src and not os.path.exists(src):
        missing_icons.append(src)

if missing_icons:
    print('âŒ Missing icon files:')
    for icon in missing_icons:
        print(f'   - {icon}')
else:
    print('âœ… All icon files exist')
"

echo "ğŸ‰ Content.json validation complete!"